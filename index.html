<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AxiomRoot ‚Ä¢ SZABIST RootFinder</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjs@11.6.0/lib/browser/math.min.js"></script>
  <style>
    :root {
      /* SZABIST-inspired palette */
      --bg-light: #f3f6fb;
      --bg-dark: #020617;
      --card-light: #ffffff;
      --card-dark: #0b1120; 
      --text-light: #020617;
      --text-dark: #e5e7eb;
      --brand: #0054a6;   /* SZABIST blue */
      --brand-2: #0b63ce; /* lighter SZABIST blue */
      --accent: #fbbf24;  /* golden accent */
    }

    body {
      font-family: 'Inter', system-ui, sans-serif;
      background: var(--bg-light);
      color: var(--text-light);
      transition: background .3s, color .3s;
    }
    body.dark {
      background: var(--bg-dark);
      color: var(--text-dark);
    }

    .card {
      background: var(--card-light);
      border-radius: 1.25rem;
      box-shadow: 0 4px 24px rgba(0,0,0,.06);
      transition: all .3s;
      border: 1px solid rgba(226,232,240,.5);
    }
    body.dark .card {
      background: var(--card-dark);
      border-color: rgba(30,64,175,.5);
      box-shadow: 0 4px 24px rgba(0,0,0,.25);
    }
    .card:hover {
      box-shadow: 0 8px 32px rgba(0,0,0,.12);
      transform: translateY(-2px);
    }
    body.dark .card:hover {
      box-shadow: 0 8px 32px rgba(0,0,0,.3);
    }

    .btn {
      font-weight: 600;
      border-radius: .75rem;
      transition: all .2s;
      cursor: pointer;
    }
    .btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(0,0,0,.15);
    }
    .btn:active:not(:disabled) {
      transform: translateY(0);
    }

    input, select {
      border-radius: .75rem;
      border: 2px solid #e2e8f0;
      padding: .7rem 1rem;
      transition: all .2s;
      background: white;
    }
    body.dark input, body.dark select {
      background: #0b1120;
      border-color: #1e293b;
      color: #e2e8f0;
    }
    input:focus, select:focus {
      outline: none;
      border-color: var(--brand);
      box-shadow: 0 0 0 4px rgba(0,84,166,.2);
    }
    body.dark input:focus, body.dark select:focus {
      border-color: var(--brand-2);
      box-shadow: 0 0 0 4px rgba(37,99,235,.25);
    }

    .brand-grad {
      background: linear-gradient(135deg, var(--brand) 0%, var(--brand-2) 100%);
      box-shadow: 0 4px 16px rgba(0,84,166,.35);
    }
    .brand-grad:hover {
      box-shadow: 0 6px 24px rgba(0,84,166,.45);
    }

    .table-sticky thead {
      position: sticky;
      top: 0;
      background: #f8fafc;
      box-shadow: 0 2px 8px rgba(0,0,0,.04);
      z-index: 10;
    }
    body.dark .table-sticky thead {
      background: #020617;
    }
    tbody tr {
      transition: background .15s;
    }
    tbody tr:hover {
      background-color: #e5edfb !important;
    }
    body.dark tbody tr:hover {
      background-color: #020b35 !important;
    }
    .highlight-row {
      background: rgba(34,197,94,.15) !important;
    }
    body.dark .highlight-row {
      background: rgba(34,197,94,.25) !important;
    }

    .spinner {
      width:40px;
      height:40px;
      border:4px solid #e2e8f0;
      border-top-color:#3b82f6;
      border-radius:9999px;
      animation: spin 1s ease-in-out infinite;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .calc-btn {
      font-size:.875rem;
      padding:.6rem;
      border-radius:.6rem;
      background:#e2e8f0;
      transition: all .15s;
      font-weight: 500;
      cursor: pointer;
    }
    .calc-btn:hover {
      background:#cbd5e1;
      transform: translateY(-1px);
      box-shadow: 0 2px 6px rgba(0,0,0,.08);
    }
    .calc-btn:active {
      transform: translateY(0);
    }
    body.dark .calc-btn {
      background:#1e293b;
      color:#e2e8f0;
    }
    body.dark .calc-btn:hover {
      background:#334155;
    }

    .chip {
      background: linear-gradient(135deg, var(--brand), var(--brand-2));
      color:#f9fafb;
      border-radius:9999px;
      padding:.35rem .8rem;
      font-size:.75rem;
      font-weight: 600;
      letter-spacing: .05em;
      text-transform: uppercase;
      box-shadow: 0 2px 6px rgba(0,84,166,.45);
    }
    body.dark .chip {
      background: linear-gradient(135deg, var(--brand-2), #1d4ed8);
      color:#e5e7eb;
    }

    .display {
      font-family: ui-monospace, Menlo, Monaco, Consolas, "Courier New", monospace;
      letter-spacing: .02em;
    }

    .result-box {
      background: linear-gradient(135deg, #011529, #ffffff);
      border: 2px solid #000000;
      transition: all .3s;
    }
    .result-box:hover {
      border-color: var(--brand);
      box-shadow: 0 4px 12px rgba(37,99,235,.15);
    }
    body.dark .result-box {
      background: linear-gradient(135deg, #020617, #0b1120);
      border-color: #1d4ed8;
    }
    body.dark .result-box:hover {
      border-color: var(--brand-2);
    }

    header {
      transition: all .3s;
    }
    /* SZABIST gradient header */
    header.szabist-header {
      background: linear-gradient(90deg, var(--brand) 0%, var(--brand-2) 55%, #020617 100%);
      color: #e5e7eb;
      border-bottom: 1px solid rgba(15,23,42,.7);
    }
    body.dark header.szabist-header {
      background: linear-gradient(90deg, #020617 0%, #020617 60%, #020617 100%) !important;
      border-color: rgba(30,64,175,.8) !important;
    }

    header h1 {
      color: #f9fafb;
    }
    header p {
      color: #e5e7eb;
    }
    header span.text-slate-700 {
      color: #facc15;
    }

    #themeToggle {
      border-color: rgba(226,232,240,.6);
      background: rgba(15,23,42,.18);
      color: #e5e7eb;
    }
    body.dark #themeToggle {
      background: rgba(15,23,42,.85);
      border-color: #1d4ed8;
      color: #e5e7eb;
    }
  </style>
</head>
<body class="min-h-screen">
  <!-- Header -->
  <header class="szabist-header backdrop-blur border-b border-slate-200">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="h-10 w-10 rounded-xl brand-grad flex items-center justify-center text-white font-bold">AR</div>
        <div>
          <h1 class="text-xl font-extrabold tracking-tight">
            AxiomRoot <span class="text-slate-200 text-sm font-medium">‚Ä¢ SZABIST RootFinder</span>
          </h1>
          <p class="text-[11px] text-slate-100 -mt-1">
            Created by <span class="font-semibold text-slate-50">Mustafa Muhammad</span>
          </p>
        </div>
      </div>
      <button id="themeToggle" class="btn px-3 py-2 border border-slate-200">üåô Dark mode</button>
    </div>
  </header>

  <!-- Main -->
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
    <div class="grid lg:grid-cols-3 gap-6">
      <!-- Function console -->
      <section class="card p-5">
        <div class="flex items-center justify-between mb-3">
          <h2 class="text-lg font-semibold">Function Console</h2>
          <span class="chip">Build expressions</span>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <!-- Calculator -->
          <div class="grid grid-cols-4 gap-2">
            <button class="calc-btn" onclick="insert('sin(')">sin</button>
            <button class="calc-btn" onclick="insert('cos(')">cos</button>
            <button class="calc-btn" onclick="insert('tan(')">tan</button>
            <button class="calc-btn" onclick="insert('abs(')">|x|</button>
            <button class="calc-btn" onclick="insert('ln(')">ln</button>
            <button class="calc-btn" onclick="insert('log(')">log</button>
            <button class="calc-btn" onclick="insert('log10(')">log</button>
            <button class="calc-btn" onclick="insert('œÄ')">œÄ</button>
            <button class="calc-btn" onclick="insert('e')">e</button>
            <button class="calc-btn" onclick="insert('^')">^</button>
            <button class="calc-btn" onclick="insert('(')">(</button>
            <button class="calc-btn" onclick="insert(')')">)</button>
            <button class="calc-btn" onclick="insert('x')">x</button>
            <button class="calc-btn" onclick="insert('+')">+</button>
            <button class="calc-btn" onclick="insert('-')">‚àí</button>
            <button class="calc-btn" onclick="insert('*')">√ó</button>
            <button class="calc-btn" onclick="insert('/')">√∑</button>
            <button class="calc-btn" onclick="insert('.')">.</button>
            <button class="calc-btn" onclick="insert(',')">,</button>
            <button class="calc-btn" onclick="insert('7')">7</button>
            <button class="calc-btn" onclick="insert('8')">8</button>
            <button class="calc-btn" onclick="insert('9')">9</button>
            <button class="calc-btn" onclick="insert('4')">4</button>
            <button class="calc-btn" onclick="insert('5')">5</button>
            <button class="calc-btn" onclick="insert('6')">6</button>
            <button class="calc-btn" onclick="insert('1')">1</button>
            <button class="calc-btn" onclick="insert('2')">2</button>
            <button class="calc-btn" onclick="insert('3')">3</button>
            <button class="calc-btn col-span-2" onclick="insert('0')">0</button>
          </div>
          <!-- Right: Input + method + clear -->
          <div class="space-y-3">
            <input
              id="expr"
              class="w-full display bg-white border-2 border-slate-200 rounded-xl px-4 py-4 text-xl shadow-sm"
              placeholder="e.g., x^3 - 2*x - 5"
            />
            <label class="text-xs text-slate-600">Method</label>
            <select id="method" class="w-full px-3 py-2 rounded-xl border border-slate-200">
              <option value="bisection">Bisection</option>
              <option value="fixedPoint">Fixed Point Iteration</option>
              <option value="falsePosition">False Position</option>
              <option value="secant">Secant</option>
              <option value="newton">Newton</option>
            </select>
            <button id="clearExpr" class="btn px-3 py-2 bg-slate-900 text-white w-full rounded-xl">Clear</button>
            <div class="mt-2 text-xs text-slate-600">
              <p class="mb-1"><strong>Quick inserts:</strong></p>
              <div class="flex flex-wrap gap-2">
                <button class="calc-btn" onclick="setExpr('x^3 - 2*x - 5')">x¬≥ - 2x - 5</button>
                <button class="calc-btn" onclick="setExpr('sin(x) - 0.5')">sin(x) - 0.5</button>
                <button class="calc-btn" onclick="setExpr('log10(x) - 2')">log(x) - 2</button>
                <button class="calc-btn" onclick="setExpr('ln(x) - 1')">ln(x) - 1</button>
                <button class="calc-btn" onclick="setExpr('sin(x) - e^-x')">sin(x) - e^-x</button>
              </div>
              <p class="mt-2 text-slate-500">Note: Radians. ln = natural log, log = base-10.</p>
            </div>
          </div>
        </div>
      </section>

      <!-- Parameters & Output -->
      <section class="lg:col-span-2 space-y-6">
        <!-- Parameters -->
        <div class="card p-5">
          <div class="flex items-center justify-between mb-4">
            <h2 class="text-lg font-semibold">Parameters</h2>
          </div>
          <div class="grid md:grid-cols-5 gap-3">
            <label class="block" for="a">
              <span class="text-xs text-slate-600">Lower bound (a) / Initial guess</span>
              <input id="a" type="number" step="any" placeholder="1" class="w-full mt-1 px-3 py-2 rounded-xl bg-white border border-slate-200" />
            </label>
            <label class="block" for="b">
              <span class="text-xs text-slate-600">Upper bound (b)</span>
              <input id="b" type="number" step="any" placeholder="3" class="w-full mt-1 px-3 py-2 rounded-xl bg-white border border-slate-200" />
            </label>
            <label class="block" for="tol">
              <span class="text-xs text-slate-600">Tolerance</span>
              <input id="tol" type="number" min="0" step="0.0000000001" value="0.0001" class="w-full mt-1 px-3 py-2 rounded-xl bg-white border border-slate-200" />
            </label>
            <label class="block" for="maxit">
              <span class="text-xs text-slate-600">Max iterations</span>
              <input id="maxit" type="number" min="1" step="1" value="100" class="w-full mt-1 px-3 py-2 rounded-xl bg-white border border-slate-200" />
            </label>
            <div class="flex items-end">
              <button id="calc" class="btn w-full py-3 rounded-xl text-white brand-grad">Calculate</button>
            </div>
          </div>
        </div>

        <!-- Summary -->
        <div id="summaryCard" class="hidden card p-5">
          <div class="flex items-center justify-between mb-3">
            <h3 class="font-semibold">Results</h3>
            <span id="iterCount" class="chip">0 iterations</span>
          </div>
          <div class="grid sm:grid-cols-3 gap-3">
            <div class="rounded-xl result-box p-4">
              <p class="text-[11px] text-slate-500">Root</p>
              <p id="rootVal" class="display text-2xl text-slate-900 dark:text-slate-100"></p>
            </div>
            <div class="rounded-xl result-box p-4">
              <p class="text-[11px] text-slate-500">f(root)</p>
              <p id="fRoot" class="display text-2xl text-slate-900 dark:text-slate-100"></p>
            </div>
            <div class="rounded-xl result-box p-4">
              <p class="text-[11px] text-slate-500">Final Error</p>
              <p id="errVal" class="display text-2xl text-slate-900 dark:text-slate-100"></p>
            </div>
          </div>
        </div>

        <!-- Table -->
        <div id="tableCard" class="hidden card p-5">
          <div class="flex items-center justify-between mb-2">
            <h3 class="font-semibold">Iteration Details</h3>
            <div class="flex gap-2">
              <button id="exportBtn" class="btn px-3 py-1 rounded-lg border border-slate-200 bg-slate-100" disabled>Export</button>
            </div>
          </div>
          <div class="overflow-x-auto max-h-[420px] overflow-y-auto rounded-xl border border-slate-200 table-sticky">
            <table class="min-w-full text-sm">
              <thead class="text-slate-700" id="tableHead"></thead>
              <tbody id="tbody" class="divide-y divide-slate-200"></tbody>
            </table>
          </div>
        </div>

        <!-- Loader -->
        <div id="loader" class="hidden fixed inset-0 bg-black/25 backdrop-blur-sm flex items-center justify-center z-50">
          <div class="card p-6 flex items-center gap-3">
            <div class="spinner"></div>
            <p class="text-slate-700 dark:text-slate-200">Computing‚Ä¶</p>
          </div>
        </div>
      </section>
    </div>

    <footer class="mt-8 text-center text-xs text-slate-500">
      ¬© AxiomRoot ‚Äî Unified RootFinder for <span class="text-slate-700 font-medium">SZABIST</span> by
      <span class="text-slate-800 font-medium">Mustafa Muhammad</span>
    </footer>
  </main>

  <script>
    const $ = (id) => document.getElementById(id);
    function formatDecimal(v){
      if(!isFinite(v)) return String(v);
      return Number.parseFloat(Number(v).toFixed(10));
    }

    // Insert / quick set / clear
    function insert(text) {
      const input = $('expr');
      const start = input.selectionStart ?? input.value.length;
      const end = input.selectionEnd ?? input.value.length;
      const before = input.value.substring(0, start);
      const after = input.value.substring(end);
      input.value = before + text + after;
      input.focus();
      const newPos = start + text.length;
      input.selectionStart = input.selectionEnd = newPos;
    }
    function setExpr(expr) { $('expr').value = expr; }
    $('clearExpr').addEventListener('click', () => { $('expr').value = ''; });

    // Theme toggle
    const themeBtn = $('themeToggle');
    const savedTheme = localStorage.getItem('axiom-theme') || 'light';
    setTheme(savedTheme);
    themeBtn.addEventListener('click', () => {
      const next = (document.documentElement.dataset.theme === 'light') ? 'dark' : 'light';
      setTheme(next);
    });
    function setTheme(mode){
      document.documentElement.dataset.theme = mode;
      document.body.classList.toggle('dark', mode==='dark');
      themeBtn.textContent = (mode === 'light') ? 'üåô Dark mode' : '‚òÄÔ∏è Light mode';
      localStorage.setItem('axiom-theme', mode);
    }

    // ===== Algorithms (unchanged math logic)
    function bisection(fn, a, b, tol, maxit){
      let fa = fn.evaluate({x:a}), fb = fn.evaluate({x:b});
      if(fa*fb >= 0) throw new Error("f(a) and f(b) must have opposite signs");
      let iterations = [], c=a, fc=fa, err=Math.abs(b-a), n=0;
      while(err>tol && n<maxit){
        n++; c=(a+b)/2; fc=fn.evaluate({x:c}); err=(b-a)/2;
        iterations.push({n,a,b,c,fc,err});
        if(fa*fc<0){ b=c; fb=fc; } else { a=c; fa=fc; }
      }
      return { root:c, froot:fc, err, iterations };
    }

    function fixedPoint(fn, a, tol, maxit){
      let x = a, iterations=[], n=0, err=Infinity;
      while(n<maxit && err>tol){
        n++;
        const xnext = fn.evaluate({x});
        err = Math.abs(xnext - x);
        iterations.push({n,x,xnext,err});
        x = xnext;
      }
      const froot = fn.evaluate({x});
      return { root:x, froot, err, iterations };
    }

    function falsePosition(fn, a, b, tol, maxit){
      let fa = fn.evaluate({x:a}), fb = fn.evaluate({x:b});
      if(fa*fb >= 0) throw new Error("f(a) and f(b) must have opposite signs");
      let iterations=[], c=a, fc=fa, prevC=a, n=0;
      while(n<maxit){
        n++; c=(a*fb - b*fa)/(fb-fa); fc=fn.evaluate({x:c});
        let err=Math.abs(c-prevC);
        iterations.push({n,a,b,fa,fb,c,fc,err});
        if(Math.abs(fc)<tol || err<tol) break;
        if(fa*fc<0){ b=c; fb=fc; } else { a=c; fa=fc; }
        prevC=c;
      }
      return { root:c, froot:fc, err:Math.abs(c-prevC), iterations };
    }

    function secant(fn, a, b, tol, maxit){
      let fa = fn.evaluate({x:a}), fb = fn.evaluate({x:b});
      let iterations=[], c=a, fc=fa, prevC=a, n=0;
      while(n<maxit){
        n++; c = b - fb * (b - a) / (fb - fa); fc = fn.evaluate({x:c});
        let err = Math.abs(c - prevC);
        iterations.push({n,a,b,fa,fb,c,fc,err});
        if(Math.abs(fc)<tol || err<tol) break;
        a = b; fa = fb; b = c; fb = fc; prevC = c;
      }
      return { root:c, froot:fc, err:Math.abs(c-prevC), iterations };
    }

    function newton(fn, exprStr, a, tol, maxit){
      const derivativeNode = math.derivative(exprStr, 'x');
      const derivative = derivativeNode.compile();
      let x = a, fx = fn.evaluate({x}), iterations=[], n=0, err=Infinity;
      while(n<maxit && err>tol){
        n++;
        const dfx = derivative.evaluate({x});
        if(dfx === 0) throw new Error("Derivative is zero, cannot continue Newton's method");
        const xnext = x - fx/dfx;
        const fxnext = fn.evaluate({x:xnext});
        err = Math.abs(xnext - x);
        iterations.push({n,x,fx,dfx,xnext,fxnext,err});
        x = xnext; fx = fxnext;
      }
      return { root:x, froot:fx, err, iterations };
    }

    // ===== Calculate handler
    $('calc').addEventListener('click', ()=> {
      const funcStr = $('expr').value.trim();
      const correctedFuncStr = funcStr.replace(/\bln\(/g, 'log(');
      const a = parseFloat($('a').value), b = parseFloat($('b').value);
      const tol = parseFloat($('tol').value), maxit = parseInt(($('maxit').value || '100'), 10);
      const method = $('method').value;

      if (!funcStr || Number.isNaN(a) || Number.isNaN(tol) || Number.isNaN(maxit)) {
        alert('Please provide f(x), initial guess/bounds, tolerance, and max iterations.');
        return;
      }
      if ((method!=="newton") && (method!=="fixedPoint") && a >= b) {
        alert('Require a < b for interval methods.');
        return;
      }

      $('loader').classList.remove('hidden');
      setTimeout(() => {
        try {
          const fn = math.compile(correctedFuncStr);
          let res;
          if (method === "bisection") {
            res = bisection(fn, a, b, tol, maxit);
          } else if (method === "fixedPoint") {
            res = fixedPoint(fn, a, tol, maxit);
          } else if (method === "falsePosition") {
            res = falsePosition(fn, a, b, tol, maxit);
          } else if (method === "secant") {
            res = secant(fn, a, b, tol, maxit);
          } else if (method === "newton") {
            res = newton(fn, correctedFuncStr, a, tol, maxit);
          }
          renderResults(res, method);
        } catch (e) {
          alert('Error: ' + e.message);
        }
        $('loader').classList.add('hidden');
      }, 60);
    });

    // ===== Render + Export
    function renderResults(res, method){
      $('summaryCard').classList.remove('hidden');
      $('tableCard').classList.remove('hidden');
      $('rootVal').textContent = formatDecimal(res.root);
      $('fRoot').textContent = formatDecimal(res.froot);
      $('errVal').textContent = formatDecimal(res.err);
      $('iterCount').textContent = `${res.iterations.length} iterations`;

      const tbody = $('tbody'); tbody.innerHTML = '';
      const thead = $('tableHead');

      if(method === "bisection"){
        thead.innerHTML = `<tr><th>Iter</th><th>x‚ÇÅ</th><th>x‚ÇÇ</th><th>x‚Çò·µ¢ùíπ</th><th>f(x‚Çò·µ¢ùíπ)</th><th>Error</th></tr>`;
        for(const it of res.iterations){
          const tr = document.createElement('tr');
          tr.innerHTML = `<td>${it.n}</td><td>${formatDecimal(it.a)}</td><td>${formatDecimal(it.b)}</td><td>${formatDecimal(it.c)}</td><td>${formatDecimal(it.fc)}</td><td>${formatDecimal(it.err)}</td>`;
          tbody.appendChild(tr);
        }
      }
      else if(method === "fixedPoint"){
        thead.innerHTML = `<tr><th>Iter</th><th>x‚Çô</th><th>x‚Çô‚Çä‚ÇÅ</th><th>Error</th></tr>`;
        for(const it of res.iterations){
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${it.n}</td>
            <td>${formatDecimal(it.x)}</td>
            <td class="font-medium text-blue-700 dark:text-blue-300">${formatDecimal(it.xnext)}</td>
            <td>${formatDecimal(it.err)}</td>`;
          tbody.appendChild(tr);
        }
      }
      else if(method === "falsePosition" || method === "secant"){
        thead.innerHTML = `<tr><th>Iter</th><th>x‚ÇÅ</th><th>x‚ÇÇ</th><th>f(x‚ÇÅ)</th><th>f(x‚ÇÇ)</th><th>x‚ÇÉ</th><th>f(x‚ÇÉ)</th><th>Error</th></tr>`;
        for(const it of res.iterations){
          const tr = document.createElement('tr');
          tr.innerHTML = `<td>${it.n}</td><td>${formatDecimal(it.a)}</td><td>${formatDecimal(it.b)}</td><td>${formatDecimal(it.fa)}</td><td>${formatDecimal(it.fb)}</td><td>${formatDecimal(it.c)}</td><td>${formatDecimal(it.fc)}</td><td>${formatDecimal(it.err)}</td>`;
          tbody.appendChild(tr);
        }
      } else if(method === "newton"){
        thead.innerHTML = `<tr><th>Iter</th><th>x</th><th>f(x)</th><th>f'(x)</th><th>x‚Çô‚Çä‚ÇÅ</th><th>f(x‚Çô‚Çä‚ÇÅ)</th><th>Error</th></tr>`;
        for(const it of res.iterations){
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${it.n}</td>
            <td>${formatDecimal(it.x)}</td>
            <td>${formatDecimal(it.fx)}</td>
            <td>${formatDecimal(it.dfx)}</td>
            <td class="font-medium text-blue-700 dark:text-blue-300">${formatDecimal(it.xnext)}</td>
            <td>${formatDecimal(it.fxnext)}</td>
            <td>${formatDecimal(it.err)}</td>`;
          tbody.appendChild(tr);
        }
      }

      const exportBtn = $('exportBtn');
      exportBtn.disabled = false;
      exportBtn.onclick = ()=> exportToCSV(res, method);

      document.getElementById('summaryCard').scrollIntoView({behavior:'smooth', block:'start'});
    }

    function exportToCSV(res, method){
      let rows = [];
      if(method === "bisection"){
        rows.push(["Iter","x1","x2","xmid","f(xmid)","Error"]);
        res.iterations.forEach(it=> rows.push([it.n,it.a,it.b,it.c,it.fc,it.err]));
      } else if(method === "falsePosition"){
        rows.push(["Iter","x1","x2","f(x1)","f(x2)","x3","f(x3)","Error"]);
        res.iterations.forEach(it=> rows.push([it.n,it.a,it.b,it.fa,it.fb,it.c,it.fc,it.err]));
      } else if(method === "secant"){
        rows.push(["Iter","x0","x1","f(x0)","f(x1)","x2","f(x2)","Error"]);
        res.iterations.forEach(it=> rows.push([it.n,it.a,it.b,it.fa,it.fb,it.c,it.fc,it.err]));
      } else if(method === "fixedPoint"){
        rows.push(["Iter","x_n","x_next","Error"]);
        res.iterations.forEach(it=> rows.push([it.n,it.x,it.xnext,it.err]));
      } else if(method === "newton"){
        rows.push(["Iter","x","f(x)","f'(x)","x_next","f(x_next)","Error"]);
        res.iterations.forEach(it=> rows.push([it.n,it.x,it.fx,it.dfx,it.xnext,it.fxnext,it.err]));
      }

      const csvContent = "data:text/csv;charset=utf-8," + rows.map(r => r.map(v => formatDecimal(v)).join(",")).join("\n");
      const link = document.createElement("a");
      link.href = encodeURI(csvContent);
      link.download = `rootfinder_${method}.csv`;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }
  </script>
</body>
</html>
